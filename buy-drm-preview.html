<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💰 Buy DRM - Preview</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Base Styles from platform.css -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #0a0a0a 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
            font-weight: 400;
            letter-spacing: 0.3px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .preview-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(0, 255, 255, 0.05);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
        }

        .preview-title {
            font-size: 32px;
            font-weight: 600;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .preview-subtitle {
            font-size: 14px;
            color: #888;
            font-weight: 400;
        }

        /* Import card styles */
        .card {
            background: rgba(10, 10, 15, 0.95) !important;
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, #ff00ff, transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
            border-color: rgba(0, 255, 255, 0.5);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #00ffff;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 0.3px;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border-radius: 2px;
        }

        .icon-gradient {
            font-size: 24px;
        }

        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .stat-card {
            background: rgba(10, 10, 15, 0.8) !important;
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            background: rgba(0, 255, 255, 0.1);
            border-color: rgba(0, 255, 255, 0.5);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #00ffff;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            letter-spacing: -0.5px;
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 1px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        /* Wallet Connection Styles */
        .wallet-section {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .connect-wallet-btn {
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            border: none;
            border-radius: 15px;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .connect-wallet-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.5);
        }

        .wallet-icon {
            font-size: 20px;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 12px 20px;
        }

        .wallet-address {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .address-label {
            font-size: 11px;
            color: #888;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .address-value {
            font-size: 14px;
            color: #00ffff;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .disconnect-btn {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: #ff6666;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .disconnect-btn:hover {
            background: rgba(255, 0, 0, 0.3);
            border-color: rgba(255, 0, 0, 0.7);
            color: #ff4444;
        }

        @media (max-width: 768px) {
            .wallet-section {
                flex-direction: column;
            }

            .wallet-info {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Admin Panel Styles */
        #adminPanel {
            border: 2px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .admin-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
            margin-left: 10px;
        }

        .admin-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .admin-group {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
        }

        .admin-group-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffd700;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }

        .admin-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .admin-stats .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: #00ffff;
        }

        .admin-input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .admin-input-group label {
            font-size: 13px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
            letter-spacing: 0.3px;
        }

        .admin-input-group input {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            color: #fff;
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }

        .admin-input-group input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .admin-btn {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 237, 78, 0.2));
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 14px 24px;
            color: #ffd700;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .admin-btn:hover {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 237, 78, 0.3));
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            transform: translateY(-2px);
        }

        .admin-btn:active {
            transform: translateY(0);
        }

        .admin-button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .pause-btn {
            border-color: #ff6b6b;
            color: #ff6b6b;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 107, 107, 0.1));
        }

        .pause-btn:hover {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(255, 107, 107, 0.2));
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
        }

        .resume-btn {
            border-color: #51cf66;
            color: #51cf66;
            background: linear-gradient(135deg, rgba(81, 207, 102, 0.2), rgba(81, 207, 102, 0.1));
        }

        .resume-btn:hover {
            background: linear-gradient(135deg, rgba(81, 207, 102, 0.3), rgba(81, 207, 102, 0.2));
            box-shadow: 0 0 20px rgba(81, 207, 102, 0.4);
        }

        /* User Balance Card Styles */
        .balance-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
            border: 2px solid rgba(0, 255, 255, 0.3);
            margin-bottom: 25px;
        }

        .balance-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .balance-icon {
            font-size: 24px;
        }

        .balance-title {
            font-size: 18px;
            font-weight: 600;
            color: #00ffff;
            letter-spacing: 0.5px;
        }

        .balance-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .balance-item {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .balance-item:hover {
            border-color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .balance-label {
            font-size: 12px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .balance-value {
            font-size: 24px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            color: #00ffff;
            letter-spacing: -0.5px;
            margin-bottom: 5px;
        }

        .balance-unit {
            font-size: 13px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.5px;
        }

        .refresh-balance-btn {
            width: 100%;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(0, 255, 255, 0.1));
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 12px 20px;
            color: #00ffff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-balance-btn:hover {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(0, 255, 255, 0.2));
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .refresh-balance-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .balance-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        /* Featured Badge for Quick Buy */
        .quick-buy-btn.featured {
            position: relative;
            border-color: rgba(255, 0, 255, 0.5);
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 255, 0.1));
        }

        .featured-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff00ff, #ff0080);
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(255, 0, 255, 0.4);
            z-index: 10;
        }

        /* Custom Input Styles - No White Background */
        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .input-label span:first-child {
            background: linear-gradient(135deg, #00ffff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        .input-hint {
            font-size: 11px;
            color: #888;
            font-weight: 400;
        }

        .input-wrapper {
            position: relative;
        }

        .custom-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 15px 80px 15px 15px;
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            letter-spacing: -0.3px;
            transition: all 0.3s ease;
        }

        .custom-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
            font-weight: 400;
        }

        .custom-input:focus {
            outline: none;
            border-color: rgba(0, 255, 255, 0.6);
            background: rgba(0, 255, 255, 0.05);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }

        .input-suffix {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .calculation-display {
            text-align: center;
            margin: 20px 0;
        }

        .calc-arrow {
            font-size: 24px;
            color: #00ffff;
            margin-bottom: 10px;
        }

        .calc-result {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 0, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        .calc-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            margin-bottom: 10px;
        }

        .calc-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            letter-spacing: -1px;
        }

        .calc-value span:first-child {
            background: linear-gradient(135deg, #ff00ff, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .calc-unit {
            font-size: 18px;
            color: #888;
            margin-left: 8px;
        }

        /* Card Title Gradient Effect */
        .card-title {
            background: linear-gradient(135deg, #00ffff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Quick Buy Button Styles */
        .quick-buy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quick-buy-btn {
            position: relative;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .quick-buy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .quick-buy-btn:hover::before {
            left: 100%;
        }

        .quick-buy-btn:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: rgba(0, 255, 255, 0.6);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }

        .quick-buy-btn:active {
            transform: translateY(-1px);
        }

        .buy-amount {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            letter-spacing: -0.3px;
            background: linear-gradient(135deg, #00ffff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .buy-arrow {
            font-size: 18px;
            color: #888;
            margin: 5px 0;
        }

        .buy-receive {
            font-size: 15px;
            font-weight: 600;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            letter-spacing: -0.3px;
            background: linear-gradient(135deg, #ff00ff, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @media (max-width: 768px) {
            .quick-buy-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .quick-buy-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Buy Now Button Styles */
        .buy-btn-large {
            position: relative;
            width: 100%;
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            border: none;
            border-radius: 15px;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 700;
            color: #000;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
        }

        .buy-btn-large::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .buy-btn-large:hover::before {
            left: 100%;
        }

        .buy-btn-large:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 255, 255, 0.5);
        }

        .buy-btn-large:active {
            transform: translateY(-1px);
        }

        .btn-icon {
            font-size: 24px;
        }

        .btn-text {
            font-size: 18px;
            font-weight: 700;
        }

        .btn-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .buy-btn-large:hover .btn-glow {
            opacity: 1;
        }
    </style>

    <!-- Buy DRM Styles -->
    <link rel="stylesheet" href="css/buy-drm-history.css">
</head>
<body>
    <div class="container">
        <!-- Legal Warning Banner -->
        <div style="background: rgba(255, 0, 0, 0.15); border: 2px solid #ff0000; border-radius: 15px; padding: 20px; margin-bottom: 30px; text-align: center;">
            <h3 style="color: #ff6666; margin-bottom: 10px; font-size: 18px;">⚠️ LEGAL WARNING / 法律警告</h3>
            <p style="color: #ffcccc; margin-bottom: 10px; font-size: 14px;">
                <strong>Educational Purpose ONLY</strong> | This platform is NOT for users in China or crypto-prohibited regions<br>
                <strong>仅供教育目的</strong> | 本平台不面向中国或禁止加密货币的地区用户
            </p>
            <a href="legal-disclaimer.html" target="_blank" style="display: inline-block; padding: 8px 20px; background: linear-gradient(135deg, #ff0000, #ff6666); color: #fff; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 13px;">
                📋 Read Full Disclaimer / 阅读完整免责声明
            </a>
        </div>

        <!-- Preview Header -->
        <div class="preview-header">
            <div class="preview-title">💰 Buy DRM Interface Preview</div>
            <div class="preview-subtitle">Dreamle Style Design - Ready to Integrate</div>

            <!-- Wallet Connection -->
            <div class="wallet-section">
                <button id="connectWalletBtn" class="connect-wallet-btn" onclick="connectWallet()">
                    <span class="wallet-icon">👛</span>
                    <span class="wallet-text">Connect Wallet</span>
                </button>
                <div id="walletInfo" class="wallet-info" style="display: none;">
                    <div class="wallet-address">
                        <span class="address-label">Connected:</span>
                        <span id="userAddress" class="address-value">0x0000...0000</span>
                    </div>
                    <button class="disconnect-btn" onclick="disconnectWallet()">Disconnect</button>
                </div>
            </div>
        </div>

        <!-- Include Buy DRM Section -->
        <div id="buy-drm" class="tab-content active">
            <!-- User Balance Display -->
            <div id="userBalanceCard" class="card balance-card" style="display: none;">
                <div class="balance-header">
                    <span class="balance-icon">👛</span>
                    <span class="balance-title">Your Wallet Balance</span>
                </div>
                <div class="balance-grid">
                    <div class="balance-item">
                        <div class="balance-label">BNB</div>
                        <div class="balance-value" id="userBnbBalance">0.0000</div>
                        <div class="balance-unit">tBNB</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-label">USDT</div>
                        <div class="balance-value" id="userUsdtBalance">0.00</div>
                        <div class="balance-unit">USDT</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-label">DRM</div>
                        <div class="balance-value" id="userDrmBalance">0.00</div>
                        <div class="balance-unit">DRM</div>
                    </div>
                </div>
                <button class="refresh-balance-btn" onclick="refreshUserBalance()">
                    <span>🔄 Refresh Balance</span>
                </button>
            </div>

            <!-- DRM Sale Information Card -->
            <div class="card glow-card">
                <div class="card-title">
                    <span class="icon-gradient">💰</span>
                    Buy DRM Tokens
                </div>
                
                <!-- Price Information -->
                <div class="price-info-container">
                    <div class="price-display">
                        <div class="price-label">Current Price</div>
                        <div class="price-value">
                            <span id="drmPriceDisplay">0.5</span>
                            <span class="price-unit">USDT/DRM</span>
                        </div>
                        <div class="price-trend">
                            <span class="trend-icon">📈</span>
                            <span class="trend-text">Fixed Price</span>
                        </div>
                    </div>
                    
                    <div class="availability-display">
                        <div class="availability-label">Available</div>
                        <div class="availability-value">
                            <span id="drmAvailableDisplay">38,672</span>
                            <span class="availability-unit">DRM</span>
                        </div>
                        <div class="availability-status">
                            <span class="status-dot"></span>
                            <span id="saleStatusDisplay">✅ Active</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Buy Options -->
            <div class="card glow-card">
                <div class="card-title">
                    <span class="icon-gradient">⚡</span>
                    Quick Buy
                </div>
                
                <div class="quick-buy-grid">
                    <button class="quick-buy-btn" onclick="quickBuyDRM(100)">
                        <div class="buy-amount">100 USDT</div>
                        <div class="buy-arrow">→</div>
                        <div class="buy-receive" data-usdt="100">500 DRM</div>
                    </button>

                    <button class="quick-buy-btn" onclick="quickBuyDRM(500)">
                        <div class="buy-amount">500 USDT</div>
                        <div class="buy-arrow">→</div>
                        <div class="buy-receive" data-usdt="500">2,500 DRM</div>
                    </button>

                    <button class="quick-buy-btn" onclick="quickBuyDRM(1000)">
                        <div class="buy-amount">1,000 USDT</div>
                        <div class="buy-arrow">→</div>
                        <div class="buy-receive" data-usdt="1000">5,000 DRM</div>
                    </button>

                    <button class="quick-buy-btn" onclick="quickBuyDRM(5000)">
                        <div class="buy-amount">5,000 USDT</div>
                        <div class="buy-arrow">→</div>
                        <div class="buy-receive" data-usdt="5000">25,000 DRM</div>
                    </button>

                    <button class="quick-buy-btn featured" onclick="quickBuyDRM(10000)">
                        <div class="featured-badge">🔥 MAX</div>
                        <div class="buy-amount">10,000 USDT</div>
                        <div class="buy-arrow">→</div>
                        <div class="buy-receive" data-usdt="10000">50,000 DRM</div>
                    </button>
                </div>
            </div>

            <!-- Custom Amount Purchase -->
            <div class="card glow-card">
                <div class="card-title">
                    <span class="icon-gradient">🎯</span>
                    Custom Amount
                </div>
                
                <div class="custom-buy-container">
                    <div class="input-group">
                        <label for="customUsdtAmount" class="input-label">
                            <span>Enter USDT Amount</span>
                            <span class="input-hint">Min: 10 USDT | Max: 10,000 USDT</span>
                        </label>
                        <div class="input-wrapper">
                            <input
                                type="number"
                                id="customUsdtAmount"
                                class="custom-input"
                                placeholder="Enter amount..."
                                min="10"
                                max="10000"
                                step="1"
                                oninput="calculateCustomDRM()"
                            >
                            <span class="input-suffix">USDT</span>
                        </div>
                    </div>
                    
                    <div class="calculation-display">
                        <div class="calc-arrow">↓</div>
                        <div class="calc-result">
                            <span class="calc-label">You will receive</span>
                            <div class="calc-value">
                                <span id="customDrmAmount">0</span>
                                <span class="calc-unit">DRM</span>
                            </div>
                        </div>
                    </div>
                    
                    <button class="buy-btn-large" onclick="buyDRMCustom()">
                        <span class="btn-icon">💎</span>
                        <span class="btn-text">Buy Now</span>
                        <span class="btn-glow"></span>
                    </button>
                </div>
            </div>

            <!-- Purchase Statistics -->
            <div class="grid grid-3">
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-value" id="totalSoldDRM">52,440 DRM</div>
                    <div class="stat-label">Total Sold</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">💵</div>
                    <div class="stat-value" id="totalRevenue">10,488 USDT</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">🛒</div>
                    <div class="stat-value" id="totalPurchases">4</div>
                    <div class="stat-label">Total Purchases</div>
                </div>
            </div>

            <!-- Admin Panel (Only visible to owner) -->
            <div id="adminPanel" class="card glow-card" style="display: none;">
                <div class="card-title">
                    <span class="icon-gradient">⚙️</span>
                    Admin Panel
                    <span class="admin-badge">OWNER</span>
                </div>

                <div class="admin-section">
                    <!-- Price Management -->
                    <div class="admin-group">
                        <div class="admin-group-title">💰 Price Management</div>
                        <div class="admin-input-group">
                            <label>New DRM Price (USDT)</label>
                            <input type="number" id="newPriceInput" placeholder="0.5" step="0.01" min="0.01">
                            <button class="admin-btn" onclick="updateDRMPrice()">
                                <span>📊 Update Price</span>
                            </button>
                        </div>
                    </div>

                    <!-- Withdraw USDT -->
                    <div class="admin-group">
                        <div class="admin-group-title">💵 Withdraw USDT</div>
                        <div class="admin-stats">
                            <span>Contract Balance:</span>
                            <span id="contractUsdtBalance" class="stat-value">0 USDT</span>
                        </div>
                        <div class="admin-input-group">
                            <label>Withdraw To Address</label>
                            <input type="text" id="withdrawUsdtAddress" placeholder="0x...">
                            <label>Amount (0 = all)</label>
                            <input type="number" id="withdrawUsdtAmount" placeholder="0" step="1" min="0">
                            <button class="admin-btn" onclick="withdrawUSDT()">
                                <span>💸 Withdraw USDT</span>
                            </button>
                        </div>
                    </div>

                    <!-- Deposit DRM -->
                    <div class="admin-group">
                        <div class="admin-group-title">💰 Deposit DRM</div>
                        <div class="admin-stats">
                            <span>Your DRM Balance:</span>
                            <span id="ownerDrmBalance" class="stat-value">0 DRM</span>
                        </div>
                        <div class="admin-stats">
                            <span>Contract Balance:</span>
                            <span id="contractDrmBalanceDeposit" class="stat-value">0 DRM</span>
                        </div>
                        <div class="admin-input-group">
                            <label>Amount to Deposit</label>
                            <input type="number" id="depositDrmAmount" placeholder="100000" step="1000" min="0">
                            <button class="admin-btn" onclick="depositDRM()">
                                <span>📥 Deposit DRM</span>
                            </button>
                        </div>
                    </div>

                    <!-- Withdraw DRM -->
                    <div class="admin-group">
                        <div class="admin-group-title">🪙 Withdraw DRM</div>
                        <div class="admin-stats">
                            <span>Contract Balance:</span>
                            <span id="contractDrmBalance" class="stat-value">0 DRM</span>
                        </div>
                        <div class="admin-input-group">
                            <label>Withdraw To Address</label>
                            <input type="text" id="withdrawDrmAddress" placeholder="0x...">
                            <label>Amount (0 = all)</label>
                            <input type="number" id="withdrawDrmAmount" placeholder="0" step="1" min="0">
                            <button class="admin-btn" onclick="withdrawDRM()">
                                <span>💎 Withdraw DRM</span>
                            </button>
                        </div>
                    </div>

                    <!-- Sale Control -->
                    <div class="admin-group">
                        <div class="admin-group-title">🎮 Sale Control</div>
                        <div class="admin-stats">
                            <span>Sale Status:</span>
                            <span id="adminSaleStatus" class="stat-value">Active</span>
                        </div>
                        <div class="admin-button-group">
                            <button class="admin-btn pause-btn" onclick="pauseSale()">
                                <span>⏸️ Pause Sale</span>
                            </button>
                            <button class="admin-btn resume-btn" onclick="resumeSale()">
                                <span>▶️ Resume Sale</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Purchase History -->
            <div class="card glow-card">
                <div class="card-title">
                    <span class="icon-gradient">📜</span>
                    Your Purchase History
                </div>

                <div id="purchaseHistoryContainer" class="history-container">
                    <div class="empty-state">
                        <div class="empty-icon">📭</div>
                        <div class="empty-text">No purchase history yet</div>
                        <div class="empty-hint">Start buying DRM tokens to see your history here</div>
                    </div>
                </div>
            </div>

            <!-- Important Notice -->
            <div class="card notice-card">
                <div class="notice-header">
                    <span class="notice-icon">ℹ️</span>
                    <span class="notice-title">Important Information</span>
                </div>
                <div class="notice-content">
                    <ul class="notice-list">
                        <li>✅ Fixed price: <strong id="noticePrice">0.5 USDT per DRM</strong></li>
                        <li>✅ Minimum purchase: <strong id="noticeMinPurchase">10 USDT</strong></li>
                        <li>✅ Maximum purchase: <strong id="noticeMaxPurchase">10,000 USDT</strong> per transaction</li>
                        <li>✅ Instant delivery after payment confirmation</li>
                        <li>✅ BSC Network: Low gas fees (~0.002-0.003 BNB per purchase)</li>
                        <li style="color: #ffd700; font-weight: 600;">⚠️ <strong>You MUST have BNB for gas fees!</strong> (~0.003 BNB per purchase)</li>
                        <li>⚠️ Approve USDT before purchasing (first time only)</li>
                        <li>⚠️ Each purchase requires 2 transactions: Approve + Buy</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Ethers.js Library (Local) -->
    <script src="libs/ethers.min.js"></script>

    <script>
        // Check if ethers loaded
        if (typeof ethers === 'undefined') {
            console.error('❌ Ethers.js failed to load');
            alert('Failed to load Web3 library. Please refresh the page.');
        } else {
            console.log('✅ Ethers.js loaded successfully');
        }
    </script>

    <!-- DRM Sale ABI -->
    <script src="js/drm-sale-abi.js"></script>

    <!-- Buy DRM Functions -->
    <script src="js/buy-drm-functions.js"></script>

    <script>
        // Global variables
        let provider = null;
        let signer = null;
        window.userAccount = null;
        const OWNER_ADDRESS = '0x5599C4fE55358C1D89Df04204407943a50a791d5'.toLowerCase();

        // Contract addresses
        const SALE_CONTRACT_ADDRESS = '0x1C8c3e823F98EFEc34FEf5673b4d63a23A251224';
        const DRM_TOKEN_ADDRESS = '0x4440409e078D44A63c72696716b84A46814717e9';
        const USDT_TOKEN_ADDRESS = '0x55d398326f99059fF775485246999027B3197955';

        // Preview calculation function
        function calculatePreviewDRM() {
            const input = document.getElementById('customUsdtAmount');
            const display = document.getElementById('customDrmAmount');

            if (!input || !display) return;

            const usdtAmount = parseFloat(input.value) || 0;
            const drmAmount = usdtAmount / 0.5; // Price: 0.5 USDT/DRM

            display.textContent = drmAmount.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            });
        }

        // Connect Wallet Function
        async function connectWallet() {
            try {
                console.log('🔌 Connecting wallet...');

                // Check if ethers is loaded
                if (typeof ethers === 'undefined') {
                    alert('Web3 library not loaded. Please refresh the page.');
                    console.error('❌ Ethers.js not loaded');
                    return;
                }

                console.log('✅ Ethers available');

                // Check if MetaMask or OKX Wallet is installed
                if (!window.ethereum) {
                    alert('Please install MetaMask or OKX Wallet!');
                    return;
                }

                // Request account access
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (accounts.length === 0) {
                    alert('No accounts found. Please unlock your wallet.');
                    return;
                }

                window.userAccount = accounts[0];
                console.log('✅ Connected:', window.userAccount);

                // Create provider and signer
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();

                // Check network
                const network = await provider.getNetwork();
                console.log('🌐 Network:', network.chainId);

                if (network.chainId !== 97) {
                    const switchNetwork = confirm('Please switch to BSC Testnet. Switch now?');
                    if (switchNetwork) {
                        try {
                            await window.ethereum.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: '0x61' }], // 97 in hex
                            });
                        } catch (switchError) {
                            // This error code indicates that the chain has not been added to MetaMask
                            if (switchError.code === 4902) {
                                try {
                                    await window.ethereum.request({
                                        method: 'wallet_addEthereumChain',
                                        params: [{
                                            chainId: '0x61',
                                            chainName: 'BSC Testnet',
                                            nativeCurrency: {
                                                name: 'BNB',
                                                symbol: 'tBNB',
                                                decimals: 18
                                            },
                                            rpcUrls: ['https://data-seed-prebsc-1-s1.binance.org:8545/'],
                                            blockExplorerUrls: ['https://testnet.bscscan.com/']
                                        }]
                                    });
                                } catch (addError) {
                                    console.error('Failed to add BSC Testnet:', addError);
                                    alert('Failed to add BSC Testnet. Please add it manually.');
                                    return;
                                }
                            } else {
                                console.error('Failed to switch network:', switchError);
                                return;
                            }
                        }
                    } else {
                        return;
                    }
                }

                // Update UI
                updateWalletUI(window.userAccount);

                // Load DRM sale data
                if (typeof window.refreshDRMSaleData === 'function') {
                    await window.refreshDRMSaleData();
                }
                if (typeof window.loadPurchaseHistory === 'function') {
                    await window.loadPurchaseHistory();
                }

                // Show success message
                showMessage('✅ Wallet connected successfully!', 'success');

            } catch (error) {
                console.error('❌ Failed to connect wallet:', error);
                alert('Failed to connect wallet: ' + error.message);
            }
        }

        // Disconnect Wallet Function
        function disconnectWallet() {
            window.userAccount = null;
            provider = null;
            signer = null;

            // Update UI
            document.getElementById('connectWalletBtn').style.display = 'flex';
            document.getElementById('walletInfo').style.display = 'none';
            document.getElementById('userBalanceCard').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';

            console.log('👋 Wallet disconnected');
            showMessage('Wallet disconnected', 'info');
        }

        // Update Wallet UI
        function updateWalletUI(address) {
            const shortAddress = address.substring(0, 6) + '...' + address.substring(address.length - 4);

            document.getElementById('userAddress').textContent = shortAddress;
            document.getElementById('connectWalletBtn').style.display = 'none';
            document.getElementById('walletInfo').style.display = 'flex';

            // Show user balance card
            document.getElementById('userBalanceCard').style.display = 'block';

            // Load user balance
            refreshUserBalance();

            // Check if user is owner and show admin panel
            checkAndShowAdminPanel(address);
        }

        // Refresh User Balance
        async function refreshUserBalance() {
            try {
                if (!window.userAccount || !provider) {
                    console.log('ℹ️ No user account or provider');
                    return;
                }

                console.log('🔄 Refreshing user balance...');

                // Get BNB balance
                const bnbBalance = await provider.getBalance(window.userAccount);

                // Get token contracts
                const usdtToken = new ethers.Contract(USDT_TOKEN_ADDRESS, ERC20_ABI, provider);
                const drmToken = new ethers.Contract(DRM_TOKEN_ADDRESS, ERC20_ABI, provider);

                // Get token balances
                const usdtBalance = await usdtToken.balanceOf(window.userAccount);
                const drmBalance = await drmToken.balanceOf(window.userAccount);

                // Update UI
                document.getElementById('userBnbBalance').textContent =
                    parseFloat(ethers.utils.formatEther(bnbBalance)).toFixed(4);

                document.getElementById('userUsdtBalance').textContent =
                    parseFloat(ethers.utils.formatEther(usdtBalance)).toLocaleString('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                document.getElementById('userDrmBalance').textContent =
                    parseFloat(ethers.utils.formatEther(drmBalance)).toLocaleString('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                console.log('✅ User balance refreshed');

            } catch (error) {
                console.error('❌ Failed to refresh user balance:', error);
            }
        }

        // Check if user is owner
        async function checkAndShowAdminPanel(address) {
            try {
                const isOwner = address.toLowerCase() === OWNER_ADDRESS;

                if (isOwner) {
                    console.log('✅ Owner detected! Showing admin panel...');
                    document.getElementById('adminPanel').style.display = 'block';

                    // Load admin data
                    await loadAdminData();
                } else {
                    document.getElementById('adminPanel').style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to check owner:', error);
            }
        }

        // Load admin data
        async function loadAdminData() {
            try {
                if (!provider) return;

                const saleContract = new ethers.Contract(
                    SALE_CONTRACT_ADDRESS,
                    DRM_SALE_ABI,
                    provider
                );

                // Get contract balances
                const usdtToken = new ethers.Contract(USDT_TOKEN_ADDRESS, ERC20_ABI, provider);
                const drmToken = new ethers.Contract(DRM_TOKEN_ADDRESS, ERC20_ABI, provider);

                const usdtBalance = await usdtToken.balanceOf(SALE_CONTRACT_ADDRESS);
                const drmBalance = await drmToken.balanceOf(SALE_CONTRACT_ADDRESS);

                // Get owner DRM balance
                const ownerDrmBalance = await drmToken.balanceOf(window.userAccount);

                // Get sale status
                const isPaused = await saleContract.isPaused();

                // Update UI
                document.getElementById('contractUsdtBalance').textContent =
                    parseFloat(ethers.utils.formatEther(usdtBalance)).toLocaleString('en-US', {maximumFractionDigits: 2}) + ' USDT';

                document.getElementById('contractDrmBalance').textContent =
                    parseFloat(ethers.utils.formatEther(drmBalance)).toLocaleString('en-US', {maximumFractionDigits: 0}) + ' DRM';

                document.getElementById('contractDrmBalanceDeposit').textContent =
                    parseFloat(ethers.utils.formatEther(drmBalance)).toLocaleString('en-US', {maximumFractionDigits: 0}) + ' DRM';

                document.getElementById('ownerDrmBalance').textContent =
                    parseFloat(ethers.utils.formatEther(ownerDrmBalance)).toLocaleString('en-US', {maximumFractionDigits: 0}) + ' DRM';

                document.getElementById('adminSaleStatus').textContent = isPaused ? '⏸️ Paused' : '✅ Active';
                document.getElementById('adminSaleStatus').style.color = isPaused ? '#ff6b6b' : '#51cf66';

                console.log('✅ Admin data loaded');
            } catch (error) {
                console.error('Failed to load admin data:', error);
            }
        }

        // Admin Functions

        // Deposit DRM
        async function depositDRM() {
            try {
                const amount = document.getElementById('depositDrmAmount').value;

                if (!amount || parseFloat(amount) <= 0) {
                    alert('Please enter a valid amount greater than 0');
                    return;
                }

                if (!signer) {
                    alert('Please connect your wallet first');
                    return;
                }

                const confirmed = confirm(`Deposit ${amount} DRM to sale contract?`);
                if (!confirmed) return;

                showMessage('⏳ Depositing DRM...', 'info');

                const drmToken = new ethers.Contract(DRM_TOKEN_ADDRESS, ERC20_ABI, signer);
                const amountInWei = ethers.utils.parseEther(amount);

                // Check balance
                const balance = await drmToken.balanceOf(window.userAccount);
                if (balance.lt(amountInWei)) {
                    showMessage('❌ Insufficient DRM balance', 'error');
                    return;
                }

                // Transfer DRM to sale contract
                const tx = await drmToken.transfer(SALE_CONTRACT_ADDRESS, amountInWei);
                showMessage('⏳ Transaction sent, waiting for confirmation...', 'info');

                await tx.wait();
                showMessage('✅ DRM deposited successfully!', 'success');

                // Clear input and reload data
                document.getElementById('depositDrmAmount').value = '';
                await loadAdminData();
                if (typeof window.refreshDRMSaleData === 'function') {
                    await window.refreshDRMSaleData();
                }
            } catch (error) {
                console.error('Failed to deposit DRM:', error);
                showMessage('❌ Failed to deposit DRM: ' + error.message, 'error');
            }
        }

        // Update DRM Price
        async function updateDRMPrice() {
            try {
                const newPrice = document.getElementById('newPriceInput').value;

                if (!newPrice || parseFloat(newPrice) <= 0) {
                    alert('Please enter a valid price greater than 0');
                    return;
                }

                if (!signer) {
                    alert('Please connect your wallet first');
                    return;
                }

                const confirmed = confirm(`Update DRM price to ${newPrice} USDT?`);
                if (!confirmed) return;

                showMessage('⏳ Updating price...', 'info');

                const saleContract = new ethers.Contract(SALE_CONTRACT_ADDRESS, DRM_SALE_ABI, signer);
                const priceInWei = ethers.utils.parseEther(newPrice);

                const tx = await saleContract.updatePrice(priceInWei);
                showMessage('⏳ Transaction sent, waiting for confirmation...', 'info');

                await tx.wait();
                showMessage('✅ Price updated successfully!', 'success');

                // Reload data
                await loadAdminData();
                if (typeof window.refreshDRMSaleData === 'function') {
                    await window.refreshDRMSaleData();
                }
            } catch (error) {
                console.error('Failed to update price:', error);
                showMessage('❌ Failed to update price: ' + error.message, 'error');
            }
        }

        // Withdraw USDT
        async function withdrawUSDT() {
            try {
                const toAddress = document.getElementById('withdrawUsdtAddress').value;
                const amount = document.getElementById('withdrawUsdtAmount').value || '0';

                if (!toAddress || !ethers.utils.isAddress(toAddress)) {
                    alert('Please enter a valid address');
                    return;
                }

                if (!signer) {
                    alert('Please connect your wallet first');
                    return;
                }

                const amountText = amount === '0' ? 'all USDT' : `${amount} USDT`;
                const confirmed = confirm(`Withdraw ${amountText} to ${toAddress}?`);
                if (!confirmed) return;

                showMessage('⏳ Withdrawing USDT...', 'info');

                const saleContract = new ethers.Contract(SALE_CONTRACT_ADDRESS, DRM_SALE_ABI, signer);
                const amountInWei = amount === '0' ? 0 : ethers.utils.parseEther(amount);

                const tx = await saleContract.withdrawUsdt(toAddress, amountInWei);
                showMessage('⏳ Transaction sent, waiting for confirmation...', 'info');

                await tx.wait();
                showMessage('✅ USDT withdrawn successfully!', 'success');

                // Clear inputs and reload data
                document.getElementById('withdrawUsdtAddress').value = '';
                document.getElementById('withdrawUsdtAmount').value = '';
                await loadAdminData();
            } catch (error) {
                console.error('Failed to withdraw USDT:', error);
                showMessage('❌ Failed to withdraw USDT: ' + error.message, 'error');
            }
        }

        // Withdraw DRM
        async function withdrawDRM() {
            try {
                const toAddress = document.getElementById('withdrawDrmAddress').value;
                const amount = document.getElementById('withdrawDrmAmount').value || '0';

                if (!toAddress || !ethers.utils.isAddress(toAddress)) {
                    alert('Please enter a valid address');
                    return;
                }

                if (!signer) {
                    alert('Please connect your wallet first');
                    return;
                }

                const amountText = amount === '0' ? 'all DRM' : `${amount} DRM`;
                const confirmed = confirm(`Withdraw ${amountText} to ${toAddress}?`);
                if (!confirmed) return;

                showMessage('⏳ Withdrawing DRM...', 'info');

                const saleContract = new ethers.Contract(SALE_CONTRACT_ADDRESS, DRM_SALE_ABI, signer);
                const amountInWei = amount === '0' ? 0 : ethers.utils.parseEther(amount);

                const tx = await saleContract.withdrawDrm(toAddress, amountInWei);
                showMessage('⏳ Transaction sent, waiting for confirmation...', 'info');

                await tx.wait();
                showMessage('✅ DRM withdrawn successfully!', 'success');

                // Clear inputs and reload data
                document.getElementById('withdrawDrmAddress').value = '';
                document.getElementById('withdrawDrmAmount').value = '';
                await loadAdminData();
            } catch (error) {
                console.error('Failed to withdraw DRM:', error);
                showMessage('❌ Failed to withdraw DRM: ' + error.message, 'error');
            }
        }

        // Pause Sale
        async function pauseSale() {
            try {
                if (!signer) {
                    alert('Please connect your wallet first');
                    return;
                }

                const confirmed = confirm('Pause the DRM sale?');
                if (!confirmed) return;

                showMessage('⏳ Pausing sale...', 'info');

                const saleContract = new ethers.Contract(SALE_CONTRACT_ADDRESS, DRM_SALE_ABI, signer);
                const tx = await saleContract.pauseSale();
                showMessage('⏳ Transaction sent, waiting for confirmation...', 'info');

                await tx.wait();
                showMessage('✅ Sale paused successfully!', 'success');

                await loadAdminData();
            } catch (error) {
                console.error('Failed to pause sale:', error);
                showMessage('❌ Failed to pause sale: ' + error.message, 'error');
            }
        }

        // Resume Sale
        async function resumeSale() {
            try {
                if (!signer) {
                    alert('Please connect your wallet first');
                    return;
                }

                const confirmed = confirm('Resume the DRM sale?');
                if (!confirmed) return;

                showMessage('⏳ Resuming sale...', 'info');

                const saleContract = new ethers.Contract(SALE_CONTRACT_ADDRESS, DRM_SALE_ABI, signer);
                const tx = await saleContract.resumeSale();
                showMessage('⏳ Transaction sent, waiting for confirmation...', 'info');

                await tx.wait();
                showMessage('✅ Sale resumed successfully!', 'success');

                await loadAdminData();
            } catch (error) {
                console.error('Failed to resume sale:', error);
                showMessage('❌ Failed to resume sale: ' + error.message, 'error');
            }
        }

        // Show Message Function
        function showMessage(message, type = 'info') {
            // Create message element
            const messageEl = document.createElement('div');
            messageEl.className = `message message-${type}`;
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(0, 255, 0, 0.2)' : type === 'error' ? 'rgba(255, 0, 0, 0.2)' : 'rgba(0, 255, 255, 0.2)'};
                border: 2px solid ${type === 'success' ? '#00ff00' : type === 'error' ? '#ff0000' : '#00ffff'};
                color: #fff;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;

            document.body.appendChild(messageEl);

            // Remove after 3 seconds
            setTimeout(() => {
                messageEl.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => messageEl.remove(), 300);
            }, 3000);
        }

        // Listen for account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function (accounts) {
                if (accounts.length === 0) {
                    disconnectWallet();
                } else {
                    window.userAccount = accounts[0];
                    updateWalletUI(accounts[0]);
                    if (typeof window.refreshDRMSaleData === 'function') {
                        window.refreshDRMSaleData();
                    }
                    if (typeof window.loadPurchaseHistory === 'function') {
                        window.loadPurchaseHistory();
                    }
                }
            });

            window.ethereum.on('chainChanged', function (chainId) {
                window.location.reload();
            });
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Page loaded');

            if (typeof ethers === 'undefined') {
                console.error('❌ Ethers.js not loaded');
                alert('Failed to load Web3 library. Please refresh the page.');
                return;
            }

            console.log('✅ Ethers.js ready');

            // Load contract data (doesn't require wallet connection)
            if (typeof window.refreshDRMSaleData === 'function') {
                await window.refreshDRMSaleData();
            }

            // Check if already connected
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        window.userAccount = accounts[0];
                        provider = new ethers.providers.Web3Provider(window.ethereum);
                        signer = provider.getSigner();
                        updateWalletUI(accounts[0]);

                        // Load purchase history (requires wallet connection)
                        if (typeof window.loadPurchaseHistory === 'function') {
                            await window.loadPurchaseHistory();
                        }
                    }
                } catch (error) {
                    console.error('Failed to check connection:', error);
                }
            }
        });

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

